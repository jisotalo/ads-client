<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>Home - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Client.html">Client</a><ul class='methods'><li data-type='method'><a href="Client.html#.defaultSettings">defaultSettings</a></li><li data-type='method'><a href="Client.html#connect">connect</a></li><li data-type='method'><a href="Client.html#createVariableHandle">createVariableHandle</a></li><li data-type='method'><a href="Client.html#deleteVariableHandle">deleteVariableHandle</a></li><li data-type='method'><a href="Client.html#disconnect">disconnect</a></li><li data-type='method'><a href="Client.html#getDataType">getDataType</a></li><li data-type='method'><a href="Client.html#getSymbolInfo">getSymbolInfo</a></li><li data-type='method'><a href="Client.html#readAndCacheDataTypes">readAndCacheDataTypes</a></li><li data-type='method'><a href="Client.html#readAndCacheSymbols">readAndCacheSymbols</a></li><li data-type='method'><a href="Client.html#readDeviceInfo">readDeviceInfo</a></li><li data-type='method'><a href="Client.html#readPlcRuntimeState">readPlcRuntimeState</a></li><li data-type='method'><a href="Client.html#readRaw">readRaw</a></li><li data-type='method'><a href="Client.html#readRawByHandle">readRawByHandle</a></li><li data-type='method'><a href="Client.html#readRawByName">readRawByName</a></li><li data-type='method'><a href="Client.html#readRawBySymbol">readRawBySymbol</a></li><li data-type='method'><a href="Client.html#readSymbol">readSymbol</a></li><li data-type='method'><a href="Client.html#readSymbolVersion">readSymbolVersion</a></li><li data-type='method'><a href="Client.html#readSystemManagerState">readSystemManagerState</a></li><li data-type='method'><a href="Client.html#readUploadInfo">readUploadInfo</a></li><li data-type='method'><a href="Client.html#subscribe">subscribe</a></li><li data-type='method'><a href="Client.html#subscribeRaw">subscribeRaw</a></li><li data-type='method'><a href="Client.html#unsubscribe">unsubscribe</a></li><li data-type='method'><a href="Client.html#unsubscribeAll">unsubscribeAll</a></li><li data-type='method'><a href="Client.html#writeRaw">writeRaw</a></li><li data-type='method'><a href="Client.html#writeRawByHandle">writeRawByHandle</a></li><li data-type='method'><a href="Client.html#writeRawBySymbol">writeRawBySymbol</a></li><li data-type='method'><a href="Client.html#writeSymbol">writeSymbol</a></li></ul></li><li><a href="ClientException.html">ClientException</a></li></ul><h3>Namespaces</h3><ul><li><a href="-_LibraryInternals.html">_LibraryInternals</a><ul class='methods'><li data-type='method'><a href="-_LibraryInternals.html#._amsNedIdStrToByteArray">_amsNedIdStrToByteArray</a></li><li data-type='method'><a href="-_LibraryInternals.html#._byteArrayToAmsNedIdStr">_byteArrayToAmsNedIdStr</a></li><li data-type='method'><a href="-_LibraryInternals.html#._checkReceivedData">_checkReceivedData</a></li><li data-type='method'><a href="-_LibraryInternals.html#._console">_console</a></li><li data-type='method'><a href="-_LibraryInternals.html#._createAmsHeader">_createAmsHeader</a></li><li data-type='method'><a href="-_LibraryInternals.html#._createAmsTcpHeader">_createAmsTcpHeader</a></li><li data-type='method'><a href="-_LibraryInternals.html#._createAmsTcpRequest">_createAmsTcpRequest</a></li><li data-type='method'><a href="-_LibraryInternals.html#._deepMergeObjects">_deepMergeObjects</a></li><li data-type='method'><a href="-_LibraryInternals.html#._getDataTypeInfo">_getDataTypeInfo</a></li><li data-type='method'><a href="-_LibraryInternals.html#._getDataTypeRecursive">_getDataTypeRecursive</a></li><li data-type='method'><a href="-_LibraryInternals.html#._onAdsCommandReceived">_onAdsCommandReceived</a></li><li data-type='method'><a href="-_LibraryInternals.html#._onAmsTcpPacketReceived">_onAmsTcpPacketReceived</a></li><li data-type='method'><a href="-_LibraryInternals.html#._onPlcRuntimeStateChanged">_onPlcRuntimeStateChanged</a></li><li data-type='method'><a href="-_LibraryInternals.html#._onRouterStateChanged">_onRouterStateChanged</a></li><li data-type='method'><a href="-_LibraryInternals.html#._onSymbolVersionChanged">_onSymbolVersionChanged</a></li><li data-type='method'><a href="-_LibraryInternals.html#._parseAdsData">_parseAdsData</a></li><li data-type='method'><a href="-_LibraryInternals.html#._parseAdsNotification">_parseAdsNotification</a></li><li data-type='method'><a href="-_LibraryInternals.html#._parseAmsHeader">_parseAmsHeader</a></li><li data-type='method'><a href="-_LibraryInternals.html#._parseAmsTcpHeader">_parseAmsTcpHeader</a></li><li data-type='method'><a href="-_LibraryInternals.html#._parseAmsTcpPacket">_parseAmsTcpPacket</a></li><li data-type='method'><a href="-_LibraryInternals.html#._parseDataType">_parseDataType</a></li><li data-type='method'><a href="-_LibraryInternals.html#._parseJsObjectToBuffer">_parseJsObjectToBuffer</a></li><li data-type='method'><a href="-_LibraryInternals.html#._parseJsVariableToPlc">_parseJsVariableToPlc</a></li><li data-type='method'><a href="-_LibraryInternals.html#._parsePlcDataToObject">_parsePlcDataToObject</a></li><li data-type='method'><a href="-_LibraryInternals.html#._parsePlcVariableToJs">_parsePlcVariableToJs</a></li><li data-type='method'><a href="-_LibraryInternals.html#._parseSymbolInfo">_parseSymbolInfo</a></li><li data-type='method'><a href="-_LibraryInternals.html#._readDataTypeInfo">_readDataTypeInfo</a></li><li data-type='method'><a href="-_LibraryInternals.html#._readSymbolInfo">_readSymbolInfo</a></li><li data-type='method'><a href="-_LibraryInternals.html#._registerAdsPort">_registerAdsPort</a></li><li data-type='method'><a href="-_LibraryInternals.html#._reInitializeInternals">_reInitializeInternals</a></li><li data-type='method'><a href="-_LibraryInternals.html#._sendAdsCommand">_sendAdsCommand</a></li><li data-type='method'><a href="-_LibraryInternals.html#._socketReceive">_socketReceive</a></li><li data-type='method'><a href="-_LibraryInternals.html#._socketWrite">_socketWrite</a></li><li data-type='method'><a href="-_LibraryInternals.html#._startSystemManagerStatePoller">_startSystemManagerStatePoller</a></li><li data-type='method'><a href="-_LibraryInternals.html#._subcribeToPlcRuntimeStateChanges">_subcribeToPlcRuntimeStateChanges</a></li><li data-type='method'><a href="-_LibraryInternals.html#._subscribe">_subscribe</a></li><li data-type='method'><a href="-_LibraryInternals.html#._subscribeToSymbolVersionChanges">_subscribeToSymbolVersionChanges</a></li><li data-type='method'><a href="-_LibraryInternals.html#._trimPlcString">_trimPlcString</a></li><li data-type='method'><a href="-_LibraryInternals.html#._unregisterAdsPort">_unregisterAdsPort</a></li><li data-type='method'><a href="-_LibraryInternals.html#._unsubscribeAllInternals">_unsubscribeAllInternals</a></li></ul></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<div id="main">
    

    



    


    <section class="package">
        <h3> </h3>		
    </section>









    



    <section class="readme usertext">
        <article><h1>ads-client</h1>
<p><a href="https://www.npmjs.org/package/ads-cllient"><img src="https://img.shields.io/npm/v/ads-client" alt="npm version"></a>
<a href="https://img.shields.io/github/license/jisotalo/ads-client"><img src="https://img.shields.io/badge/View%20on-GitHub!-brightgreen" alt="GitHub"></a>
<a href="https://choosealicense.com/licenses/mit/"><img src="https://img.shields.io/github/license/jisotalo/ads-client" alt="License"></a></p>
<p>Unofficial node.js ADS library for connecting to Beckhoff TwinCAT automation systems using ADS protocol.</p>
<p>Coded from scratch using <a href="https://infosys.beckhoff.com/content/1033/tc3_ads_intro/116157835.html?id=124964102706356243">TwinCAT ADS specification</a> and <a href="https://www.nuget.org/packages/Beckhoff.TwinCAT.Ads/5.0.0-preview6">Beckhoff.TwinCAT.Ads nuget package</a>. Inspiration from similar projects like <a href="https://www.npmjs.com/package/node-ads">node-ads</a>, <a href="https://www.npmjs.com/package/beckhoff-js">beckhoff-js</a> and <a href="https://www.npmjs.com/package/iecstruct">iecstruct</a>.</p>
<hr>
<h2><em><strong>NOTE:</strong> Readme is still under construction!</em></h2>
<p><strong>Important note</strong>:</p>
<p><a href="https://github.com/jisotalo/ads-client/milestone/1"><img src="https://img.shields.io/github/milestones/progress-percent/jisotalo/ads-client/1" alt="GitHub milestone"></a></p>
<p>There is still some work to do for &quot;production ready&quot; version. See this <a href="https://github.com/jisotalo/ads-client/milestone/1">Github milestone for details</a></p>
<hr>
<h1>Latest update</h1>
<h2>[1.1.0] - 16.04.2020</h2>
<h3>Added</h3>
<ul>
<li>Support for pseudo data types (like PVOID, XINT, UXINT etc.)</li>
<li>Reserved ADS ports to ads-client-ads.js</li>
</ul>
<h3>Changed</h3>
<ul>
<li>writeSymbol is now case-insensitive (as the PLC system is)</li>
<li>Fixed bug: Changed iconv-encode unicode to ucs2 at WSTRING</li>
<li>Fixed bug: Better suppor for arrays when using <code>autoFill = true</code> parameter</li>
<li>Updated README.md
<ul>
<li>array examples</li>
<li><code>writeSymbol</code> and case-insensitive information</li>
</ul>
</li>
</ul>
<hr>
<h1>Table of contents</h1>
<ul>
<li><a href="#installation">Features</a></li>
<li><a href="#installation">Installation</a></li>
<li><a href="#enabling-localhost-support">Enabling localhost support</a></li>
<li><a href="#important-note-about-struct-variables">IMPORTANT: Note about STRUCT variables</a></li>
<li><a href="#important-note-writing-sturct-variables">IMPORTANT: Writing STRUCT variables</a></li>
<li><a href="#getting-started">Getting started</a>
<ul>
<li><a href="data-types-used-in-getting-started">Data types used in getting started</a></li>
<li><a href="#creating-a-new-client-instance">Creating a new Client instance</a></li>
<li><a href="#connecting-and-disconnecting">Connecting and disconnecting</a></li>
<li><a href="#reading-any-plc-variable">Reading any PLC variable</a>
<ul>
<li><a href="#reading-int-type-variable">Reading INT type variable</a></li>
<li><a href="#reading-string-type-variable">Reading STRING type variable</a></li>
<li><a href="#reading-enum-type-variable">Reading ENUM type variable</a></li>
<li><a href="#reading-struct-type-variable">Reading STRUCT type variable</a></li>
<li><a href="#reading-array-of-int-type-variable">Reading ARRAY OF INT type variable</a></li>
<li><a href="#reading-array-of-struct-type-variable">Reading ARRAY OF STRUCT type variable</a></li>
</ul>
</li>
<li><a href="#writing-any-plc-variable">Writing any PLC variable</a>
<ul>
<li><a href="#writing-int-type-plc-variable">Writing INT type PLC variable</a></li>
<li><a href="#writing-string-type-plc-variable">Writing STRING type PLC variable</a></li>
<li><a href="#writing-enum-type-variable">Writing ENUM type variable</a></li>
<li><a href="#writing-struct-type-plc-variable">Writing STRUCT type PLC variable</a></li>
<li><a href="#writing-struct-type-plc-variable-with-autofill-parameter">Writing STRUCT type PLC variable (with autoFill parameter)</a></li>
<li><a href="#writing-array-of-int-type-variable">Writing ARRAY OF INT type variable</a></li>
<li><a href="#writing-array-of-struct-type-variable">Writing ARRAY of STRUCT type variable</a></li>
</ul>
</li>
<li><a href="#subscribing-to-plc-variables-device-notifications">Subscribing to PLC variables (device notifications)</a>
<ul>
<li><a href="#subcribe-to-variable-value-on-change">Subcribe to variable value (on-change)</a></li>
<li><a href="#subcribe-to-variable-value-cyclic">Subcribe to variable value (cyclic)</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#documentation">Documentation</a></li>
<li><a href="#license">License</a></li>
</ul>
<h1>Features</h1>
<ul>
<li>Promises and async/await</li>
<li>Supports connecting to the local TwinCAT runtime (see <a href="#localhost-support">enabling localhost support</a>)</li>
<li>Supports multiple connections from the same host</li>
<li>Reading and writing all kinds of variables by PLC variable name</li>
<li>Subscribing to variable changes by PLC variable name (ADS notifications)</li>
<li>Automatic conversion from PLC variables to Javascript objects and vice-versa</li>
<li>Reading symbol and data type information</li>
<li>Reading PLC runtime and system manager states</li>
<li>Caching symbol and data type information (only read at first time when needed)</li>
<li>Automatic pointer/reference support for 32bit and 64bit systems</li>
<li>Automatic updating of symbols, data types and subscriptions when PLC program changes or system starts (<em>NOTE: Not 100 % ready yet</em>)</li>
<li>Tested to work successfully
<ul>
<li>Node.js v10.16.3 and newer</li>
<li>Local computer with TwinCAT 3 4022.27 running on 64bit Windows 10</li>
<li>Local computer with TwinCAT 3 4024.4 running on 64bit Windows 10</li>
<li>Beckhoff PLC with TwinCAT 3 4022.27 running on 64bit Windows 7 Embedded</li>
</ul>
</li>
<li>Yet to be tested
<ul>
<li>Beckhoff PLC with 32 bit system</li>
<li>TwinCAT 2 systems</li>
<li>Running on Linux device with and without ADS router</li>
<li>Running on Windows device without ADS router</li>
</ul>
</li>
</ul>
<h1>Installation</h1>
<p>Install the <a href="https://www.npmjs.com/package/ads-client">npm package</a> using npm command:</p>
<pre class="prettyprint source lang-bash"><code>npm i ads-client
</code></pre>
<p>Include the module in your code</p>
<pre class="prettyprint source lang-js"><code>const ads = require('ads-client')
</code></pre>
<h1>Enabling localhost support</h1>
<p><em>NOTE: Only required for TwinCAT versions older than 4024.5. Newer versions have this already enabled.</em></p>
<p>If you want to connect to the local TwinCAT runtime (Node.js and the TwinCAT on the same computer - <strong>as in these examples</strong>), the ADS router TCP loopback feature has to be enabled. Tested with TwinCAT 4022.27 and 4024.4.</p>
<p>The following method is from <a href="https://www.nuget.org/packages/Beckhoff.TwinCAT.Ads/5.0.0-preview6">Beckhoff.TwinCAT.Ads nuget package</a> installation guide.</p>
<ol>
<li>
<p>Stop TwinCAT System Service</p>
</li>
<li>
<p>Enable TCP Loopback for TwinCAT via registery (regedit):</p>
<ul>
<li>
<p>32-Bit Windows Operating System:</p>
<pre class="prettyprint source"><code>Create following DWORD and set value to 1:
HKEY_LOCAL_MACHINE\SOFTWARE\Beckhoff\TwinCAT3\System\EnableAmsTcpLoopback
</code></pre>
</li>
<li>
<p>64-Bit Windows Operating System:</p>
<pre class="prettyprint source"><code>Create following DWORD and set value to 1:
HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Beckhoff\TwinCAT3\System\EnableAmsTcpLoopback
</code></pre>
</li>
</ul>
</li>
<li>
<p>Restart TwinCAT System Service</p>
</li>
</ol>
<p>Now you can connect to the localhost using <code>localAmsNetId</code> address of <code>127.0.0.1.1.1</code> or <code>localhost</code>.</p>
<h1>IMPORTANT: Note about STRUCT variables</h1>
<p>At the moment all structs need to have attribute <code>{attribute 'pack_mode' := '1'}</code> above the definition. This forces the TwinCAT to use 1-byte variable alignment.</p>
<pre class="prettyprint source"><code>{attribute 'pack_mode' := '1'}
TYPE ST_Example :
STRUCT
	SomeText : STRING(50) := 'Hello ads-client';
	SomeReal : REAL := 3.14159265359;
END_STRUCT
END_TYPE
</code></pre>
<p>If the attribute is not found, the library will print a warning to the console:</p>
<pre class="prettyprint source"><code>ads-client: WARNING: PLC data type ST_Example is a STRUCT and has no attribute {attribute 'pack_mode' := '1'} above it's definition -> Read data may be corrupted depending on the struct layout. Disable this warning with setting 'disableStructPackModeWarning: true'
</code></pre>
<p>The warning can be hidden using setting <code>'disableStructPackModeWarning: true'</code>. If the pack-mode is not defined, reading or writing data will cause corrupted data in some cases.</p>
<p>See <a href="https://github.com/jisotalo/ads-client/issues/13">this GitHub issue</a> for developing support for TwinCAT 3 default byte alignment.</p>
<hr>
<h1>IMPORTANT: Writing STRUCT variables</h1>
<p>When writing a struct using <code>writeSymbol</code>, the given Javascript object keys are handled as case-insensitive because the TwinCAT 3 system is <strong>case-insensitive</strong>.</p>
<p>Basically this means that the following Javascript objects are used as-equals if passing to the <code>writeSymbol</code> method:</p>
<pre class="prettyprint source lang-js"><code>{
  sometext: 'hello',
  somereal: 3.14
}
</code></pre>
<pre class="prettyprint source lang-js"><code>{
  SOmeTEXT: 'hello',
  SOMEreal: 3.14
}
</code></pre>
<p><strong>NOTE</strong> If the object has multiple keys with same name, <code>writeSymbol</code> tries to find the same case as in PLC. If it's not found, it depends on the <code>Object.find()</code> method which one is selected.</p>
<pre class="prettyprint source lang-js"><code>//In this case, probably the first one (sometext) is selected and the SOMEtext is skipped.
{
  sometext: 'hello',
  SOMEtext: 'good day'
}
</code></pre>
<h1>Getting started</h1>
<p>This chapter includes some short getting started examples. See the JSDoc <a href="#documentation">documentation</a> for detailed description of library classes and methods.</p>
<h2>Data types used in getting started</h2>
<p>These examples assume that the PLC has the following Global Variable List (GVL):</p>
<pre class="prettyprint source"><code>//GVL_Test
VAR_GLOBAL
	TestINT         	: INT := 1234;
	TestSTRING 	    	: STRING := 'Hello this is a test string';
	ExampleSTRUCT   	: ST_Example;
	TestARRAY  			: ARRAY[0..4] OF INT := [0, 10, 200, 3000, 4000];
	TestARRAY2			: ARRAY[0..4] OF ST_Example := [(SomeText := 'Just for demo purposes')];
	TestENUM  			: E_TestEnum := E_TestEnum.Running;
	IncrementingValue 	: INT; //This should change every 500 ms or so
END_VAR
</code></pre>
<p>The <code>ST_Example</code> should be defined as below:</p>
<pre class="prettyprint source"><code>{attribute 'pack_mode' := '1'}
TYPE ST_Example :
STRUCT
	SomeText : STRING(50) := 'Hello ads-client';
	SomeReal : REAL := 3.14159265359;
	SomeDate : DT := DT#2020-4-13-12:25:33;
END_STRUCT
END_TYPE
</code></pre>
<p>The <code>E_TestEnum</code> should be defined as below:</p>
<pre class="prettyprint source"><code>TYPE E_TestEnum :
(
	Disabled 	:= 0,
	Starting 	:= 50,
	Running 	:= 100,
	Stopping	:= 200	
);
END_TYPE
</code></pre>
<h2>Creating a new Client instance</h2>
<p>The constructor takes settings as its parameter. Two settings are mandatory: <code>targetAmsNetId</code> and <code>targetAdsPort</code>. The first is the target PLC system AmsNetId (like <em>127.0.0.1.1.1</em> or <em>192.168.1.10.1.1</em>) and the latter is target system ADS port (<em>like 851 for TwinCAT 3 runtime 1</em>).</p>
<p>See all settings from the <a href="https://jisotalo.github.io/ads-client/global.html#Settings">Settings documentation</a></p>
<pre class="prettyprint source lang-js"><code>const ads = require('ads-client')

//Creates a new Client instance and sets the local system and TC3 runtime 1 as target
const client = new ads.Client({
  targetAmsNetId: '127.0.0.1.1.1', //Loopback address, same as 'localhost' since version 1.1.0
  targetAdsPort: 851,
})
</code></pre>
<h2>Connecting and disconnecting</h2>
<p>Connecting to the local TwinCAT 3 runtime 1 (port is 851) using local ADS router (= you have TwinCAT ADS router installed).</p>
<pre class="prettyprint source lang-js"><code>const ads = require('ads-client')

const client = new ads.Client({
  targetAmsNetId: '127.0.0.1.1.1',
  targetAdsPort: 851
})

client.connect()
  .then(res => {   
    console.log(`Connected to the ${res.targetAmsNetId}`)
    console.log(`Router assigned us AmsNetId ${res.localAmsNetId} and port ${res.localAdsPort}`)

    return client.disconnect()
  })
  .then(() => {
    console.log('Disconnected')
  })
  .catch(err => {
    console.log('Something failed:', err)
  })

/*
Example console output:

Connected to the 127.0.0.1.1.1
Router assigned us AmsNetId 192.168.1.1.1.1 and port 36837
Disconnected
*/
</code></pre>
<h2>Reading any PLC variable</h2>
<p>By using <code>readSymbol</code> method we can read all kind of types from the PLC, including base type variables, structs, arrays and so on. These examples cover just a few cases.</p>
<p>See full <code>readSymbol</code> documentation <a href="https://jisotalo.github.io/ads-client/Client.html#readSymbol">from the docs</a>.</p>
<h3>Reading <code>INT</code> type variable</h3>
<pre class="prettyprint source lang-js"><code>//Using Promises
client.readSymbol('GVL_Test.TestSTRING')
  .then(res => {
    console.log(`Value read: ${res.value}`)
  })
  .catch(err => {
    console.log('Something failed:', err)
  })

/*
Example console output:

Value read: 1234
*/
</code></pre>
<hr>
<h3>Reading <code>STRING</code> type variable</h3>
<pre class="prettyprint source lang-js"><code>client.readSymbol('GVL_Test.TestSTRING')
  .then(res => {
    console.log(`Value read: ${res.value}`)
  })
  .catch(err => {
    console.log('Something failed:', err)
  })
/*
Example console output:

Value read: Hello this is a test string
*/
</code></pre>
<hr>
<h3>Reading <code>ENUM</code> type variable</h3>
<p>If <code>objectifyEnumerations</code> is set to false, only ENUM value (number) is returned.</p>
<pre class="prettyprint source lang-js"><code>//objectifyEnumerations: true
client.readSymbol('GVL_Test.TestENUM')
  .then(res => {
    console.log(`Value read: ${res.value}`)
  })
  .catch(err => {
    console.log('Something failed:', err)
  })

/*
Example console output:

Value read: { name: 'Running', value: 100 }
*/
</code></pre>
<hr>
<h3>Reading <code>STRUCT</code> type variable</h3>
<p><strong>IMPORTANT NOTE:</strong> See chapter <a href="#IMPORTANT-Note-about-STRUCT-variables">IMPORTANT: Note about STRUCT variables</a></p>
<pre class="prettyprint source lang-js"><code>//Using await for example purposes
try {
  const res = await client.readSymbol('GVL_Test.ExampleSTRUCT')

  console.log('Value read:', res.value)
} catch (err) {
  console.log('Reading failed:', err)
}

/*
Example console output:

Value read: { SomeText: 'Hello ads-client',
  SomeReal: 3.1415927410125732,
  SomeDate: 2020-04-13T12:25:33.000Z }   
*/
</code></pre>
<hr>
<h3>Reading <code>ARRAY OF INT</code> type variable</h3>
<p><strong>NOTE:</strong> Handling multi-dimensional arrays is not supported at the moment. See <a href="https://github.com/jisotalo/ads-client/issues/10">this GitHub issue</a> for the development of the multi-dimensional array support.</p>
<pre class="prettyprint source lang-js"><code>try {
  const res = await client.readSymbol('GVL_Test.TestARRAY')

  console.log('Value read:', res.value)
} catch (err) {
  console.log('Reading failed:', err)
}

/*
Example console output:

Value read: [ 0, 10, 200, 3000, 4000 ] 
*/
</code></pre>
<hr>
<h3>Reading <code>ARRAY OF STRUCT</code> type variable</h3>
<p><strong>NOTE:</strong> Handling multi-dimensional arrays is not supported at the moment. See <a href="https://github.com/jisotalo/ads-client/issues/10">this GitHub issue</a> for the development of the multi-dimensional array support.</p>
<pre class="prettyprint source lang-javascript"><code>try {
  const res = await client.readSymbol('GVL_Test.TestARRAY2')

  console.log('Value read:', res.value)
} catch (err) {
  console.log('Reading failed:', err)
}

/*
Example console output:

Value read: [ { SomeText: 'Just for demo purposes',
    SomeReal: 3.1415927410125732,
    SomeDate: 2020-04-13T12:25:33.000Z },
  { SomeText: 'Hello ads-client',
    SomeReal: 3.1415927410125732,
    SomeDate: 2020-04-13T12:25:33.000Z },
  { SomeText: 'Hello ads-client',
    SomeReal: 3.1415927410125732,
    SomeDate: 2020-04-13T12:25:33.000Z },
  { SomeText: 'Hello ads-client',
    SomeReal: 3.1415927410125732,
    SomeDate: 2020-04-13T12:25:33.000Z },
  { SomeText: 'Hello ads-client',
    SomeReal: 3.1415927410125732,
    SomeDate: 2020-04-13T12:25:33.000Z } ]
*/
</code></pre>
<hr>
<h2>Writing any PLC variable</h2>
<p>By using <code>writeSymbol</code> method we can write all kind of types to the PLC, including base type variables, structs, arrays and so on. These examples cover just a few cases.</p>
<p>See full <code>writeSymbol</code> documentation <a href="https://jisotalo.github.io/ads-client/Client.html#writeSymbol">from the docs</a>.</p>
<hr>
<h3>Writing <code>INT</code> type PLC variable</h3>
<pre class="prettyprint source lang-js"><code>try {
  const res = await client.writeSymbol('GVL_Test.TestINT', 5)

  console.log('Value written:', res.value)
} catch (err) {
  console.log('Something failed:', err)
}
</code></pre>
<hr>
<h3>Writing <code>STRING</code> type PLC variable</h3>
<pre class="prettyprint source lang-js"><code>
try {
  const res = await client.writeSymbol('GVL_Test.TestSTRING', 'Changing the string value to this')

  console.log('Value written:', res.value)
} catch (err) {
  console.log('Something failed:', err)
}
</code></pre>
<hr>
<h3>Writing <code>ENUM</code> type variable</h3>
<p>When writing <code>ENUM</code> value, it can always be given as number or string.</p>
<pre class="prettyprint source lang-js"><code>try {
  const res = await client.writeSymbol('GVL_Test.TestENUM', 'Starting')
  //The following does the same:
  //const res = await client.writeSymbol('GVL_Test.TestENUM', 50)

  console.log('Value written:', res.value)
} catch (err) {
  console.log('Something failed:', err)
}
</code></pre>
<hr>
<h3>Writing <code>STRUCT</code> type PLC variable</h3>
<p><strong>IMPORTANT NOTE:</strong> See chapter <a href="#IMPORTANT-Note-about-STRUCT-variables">IMPORTANT: Note about STRUCT variables</a></p>
<pre class="prettyprint source lang-js"><code>try {
  const res = await client.writeSymbol('GVL_Test.ExampleSTRUCT', {
    SomeText: 'Hello to you too, Mr. PLC!',
    SomeReal: 5456.06854,
    SomeDate: new Date()
  })

  console.log('Value written:', res.value)
} catch (err) {
  console.log('Something failed:', err)
}
</code></pre>
<h3>Writing <code>STRUCT</code> type PLC variable (with autoFill parameter)</h3>
<hr>
<p><strong>IMPORTANT NOTE:</strong> See chapter <a href="#IMPORTANT-Note-about-STRUCT-variables">IMPORTANT: Note about STRUCT variables</a></p>
<p>The following code will not work. The PLC struct has three members but we provide only two, which causes an exception.</p>
<pre class="prettyprint source lang-js"><code>//NOTE: This won't work
try {
  const res = await client.writeSymbol('GVL_Test.ExampleSTRUCT', {
    SomeReal: 123.45,
    SomeText: 'This will not work...'
  })

} catch (err) {
  console.log('Something failed:', err)
}

/*
Example console output

Something failed: { ClientException: Writing symbol GVL_Test.ExampleSTRUCT failed: Given Javascript object is missing key/value for at least &quot;.SomeDate&quot; (DATE_AND_TIME) - Set writeSymbol() 3rd parameter (autoFill) to true to allow uncomplete objects
    at Promise ...
*/
</code></pre>
<p>We need to tell the <code>WriteSymbol</code> that we <em>indeed</em> want to write just some members and the rest will stay the same. This happens by setting the 3rd parameter <code>autoFill</code> to true.</p>
<p>If <code>autoFill</code> is true, the method first reads the latest value and then writes it with only the new given changes.</p>
<pre class="prettyprint source lang-js"><code>try {
  const res = await client.writeSymbol('GVL_Test.ExampleSTRUCT', {
    SomeReal: 123.45,
    SomeText: 'But this works!'
  }, true) //Note this!

  console.log('Value written:', res.value)

} catch (err) {
  console.log('Something failed:', err)
}
</code></pre>
<p>Of course, it would be possible to do with two separate commands too:</p>
<pre class="prettyprint source lang-js"><code>res = await client.writeSymbol('GVL_Test.ExampleSTRUCT.SomeReal', 123.45)
res = await client.writeSymbol('GVL_Test.ExampleSTRUCT.SomeText', 'This is also possible')
</code></pre>
<hr>
<h3>Writing <code>ARRAY OF INT</code> type variable</h3>
<pre class="prettyprint source lang-js"><code>try {
  const res = await client.writeSymbol('GVL_Test.TestArray', [9999, 8888, 6666, 5555, 4444])

  console.log('Value written:', res.value)

} catch (err) {
  console.log('Something failed:', err)
  return
}
</code></pre>
<hr>
<h3>Writing <code>ARRAY of STRUCT</code> type variable</h3>
<pre class="prettyprint source lang-js"><code>try {
  const res = await client.writeSymbol('GVL_Test.TestArray', 
    [ { SomeText: 'First value',
        SomeReal: 1.0,
        SomeDate: new Date()},
      { SomeText: 'Second',
        SomeReal: 10.10,
        SomeDate: new Date()},
      { SomeText: 'Third',
        SomeReal: 20.20,
        SomeDate: new Date()},
      { SomeText: 'Fourth',
        SomeReal: 30.30,
        SomeDate: new Date()},
      { SomeText: 'Fifth',
        SomeReal: 40.40,
        SomeDate: new Date()}]
  )

  console.log('Value written:', res.value)
  
} catch (err) {
  console.log('Something failed:', err)
  return
}
</code></pre>
<h2>Subscribing to PLC variables (device notifications)</h2>
<p>By using <code>subscribe</code> method, we can receive variable values automatically from the PLC if they change or periodically.</p>
<p>See full <code>subscribe</code> documentation <a href="https://jisotalo.github.io/ads-client/Client.html#subscribe">from the docs</a>.</p>
<hr>
<h3>Subcribe to variable value (on-change)</h3>
<p>The following wants the PLC to check if the value has changed every 1000 milliseconds. If it has changed, callback is called with the latest value in <code>data</code> parameter.</p>
<p>After 10 seconds the subscription is unsubscribed.</p>
<pre class="prettyprint source lang-js"><code>try {
  let subscription = await client.subscribe('GVL_Test.IncrementingValue', (data, sub) => {
    //Note: The sub parameter is the same as returned by client.subcribe()
    console.log(`${data.timeStamp}: Value changed to ${data.value}`)

  }, 1000)

  console.log(`Subscribed to ${subscription.target}`)

  //Unsubscribe and disconnect after 10 seconds
  setTimeout((async () => {
    //The subscribe() returns object that contains unsubscribe() method
    await subscription.unsubscribe()

    console.log('Unsubscribed')
  }), 10000)

} catch (err) {
  console.log('Something failed:', err)
  return
}

/*
Example console output

Subscribed to GVL_Test.IncrementingValue
Mon Apr 13 2020 13:02:26 GMT+0300 (GMT+03:00): Value changed to 1586
Mon Apr 13 2020 13:02:27 GMT+0300 (GMT+03:00): Value changed to 1588
Mon Apr 13 2020 13:02:28 GMT+0300 (GMT+03:00): Value changed to 1590
...
Mon Apr 13 2020 13:02:34 GMT+0300 (GMT+03:00): Value changed to 1602
Unsubscribed
</code></pre>
<hr>
<h3>Subcribe to variable value (cyclic)</h3>
<p>The following wants the PLC to send the variable value every 1000 milliseconds. The callback is called with the latest value in <code>data</code> parameter (it might have changed or not).</p>
<pre class="prettyprint source lang-js"><code>//Our callback function
const onChange = (data, sub) => {
  console.log(`${data.timeStamp}: ${sub.target} changed to ${data.value}`)

  //We can call sub.unsubscribe() here if we want
}

try {
  let subscription = await client.subscribe('GVL_Test.IncrementingValue', onChange, 1000, false)

  console.log(`Subscribed to ${subscription.target}`)

} catch (err) {
  console.log('Something failed:', err)
  return
}

/*
Example console output


Subscribed to GVL_Test.IncrementingValue
Mon Apr 13 2020 13:09:04 GMT+0300 (GMT+03:00): GVL_Test.IncrementingValue changed to 273
Mon Apr 13 2020 13:09:05 GMT+0300 (GMT+03:00): GVL_Test.IncrementingValue changed to 275
Mon Apr 13 2020 13:09:06 GMT+0300 (GMT+03:00): GVL_Test.IncrementingValue changed to 277
...
</code></pre>
<h1>Documentation</h1>
<p>You can find the full html documentation from the project <a href="https://jisotalo.github.io/ads-client/">GitHub home page</a> as well as from <code>./docs/</code> folder in the repository.</p>
<h1>License</h1>
<p>Licensed under <a href="http://www.opensource.org/licenses/MIT">MIT License</a>.</p>
<p>Copyright (c) 2020 Jussi Isotalo &lt;<a href="mailto:j.isotalo91@gmail.com">j.isotalo91@gmail.com</a>&gt;</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the &quot;Software&quot;), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.</p></article>
    </section>






    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> on Mon Apr 20 2020 17:47:00 GMT+0300 (GMT+03:00) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>